<%- include('partials/head', { activeNav: 'orders' }) %>

  <div class="card">
    <div class="card-header">Filters</div>
    <form class="filters" method="get" action="/orders">
      <div>
        <label>Status</label>
        <select name="status" multiple>
          <% statuses.forEach(function(s){ %>
            <option value="<%= s.Id %>" <%= selectedStatus.includes(s.Id) ? 'selected' : '' %>><%= s.Name %></option>
          <% }) %>
        </select>
      </div>

      <div>
        <label>Courier Service</label>
        <select name="courier" multiple>
          <% couriers.forEach(function(c){ %>
            <option value="<%= c.Id %>" <%= selectedCourier.includes(c.Id) ? 'selected' : '' %>><%= c.Name %></option>
          <% }) %>
        </select>
      </div>

      <div>
        <button class="btn btn-primary" type="submit">Apply Filters</button>
      </div>
    </form>
  </div>

  <div class="card mt-2">
    <div class="flex space-between items-center mb-2">
      <div class="card-header">Orders</div>
      <span id="count" class="badge"></span>
    </div>

    <form method="post" action="/manifest/submit">
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th><input type="checkbox" id="checkAll" /></th>
              <th>Order ID</th>
              <th>Order #</th>
              <th>Status</th>
              <th>Courier</th>
              <th>Customer</th>
              <th>City</th>
              <th>Postcode</th>
              <th>Country</th>
              <th>Weight</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody>
            <% orders.forEach(function(o){ %>
              <tr>
                <td><input type="checkbox" name="orderIds" value="<%= o.OrderId %>" class="rowCheck" /></td>
                <td><%= o.OrderId %></td>
                <td><%= o.OrderNumber || '' %></td>
                <td><%= statusMap.get(o.OrderStatusId) || o.OrderStatusId %></td>
                <td><%= (o.CourierServiceId != null ? (courierMap.get(o.CourierServiceId) || o.CourierServiceId) : '') %></td>
                <td><%= o.CustomerName || '' %></td>
                <td><%= o.City || '' %></td>
                <td><%= o.Postcode || '' %></td>
                <td><%= o.CountryCode || '' %></td>
                <td><%= (o.Weight ?? '') %></td>
                <td><%= o.CreatedDate || '' %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <div class="mt-2">
        <button class="btn btn-success" type="submit">Submit Selected to IOM Manifest</button>
      </div>
    </form>
  </div>

  <script>
    const checkAll = document.getElementById('checkAll');
    const rowChecks = Array.from(document.querySelectorAll('.rowCheck'));
    const countEl = document.getElementById('count');

    function updateCount(){
      const n = rowChecks.filter(c => c.checked).length;
      countEl.textContent = n ? `${n} selected` : '';
    }

    if (checkAll) {
      checkAll.addEventListener('change', () => {
        rowChecks.forEach(c => c.checked = checkAll.checked);
        updateCount();
      });
    }
    rowChecks.forEach(c => c.addEventListener('change', updateCount));
  </script>

<%- include('partials/foot') %>
